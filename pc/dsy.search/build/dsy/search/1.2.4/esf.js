define("dsy/search/1.2.4/esf",["jquery","dsy/search/1.2.4/interface"],function(require,exports,module){"use strict";function ESFSearch(){Search.call(this),this.tag="esf",this.suffix="\u4e8c\u624b\u623f",this.init()}var $=require("jquery"),vars=seajs.data.vars,Search=require("dsy/search/1.2.4/interface");$.extend(ESFSearch.prototype,new Search),ESFSearch.prototype.init=function(){this.tpl=["<tr data-key=\"{{search_key}}\" data-search='{{search_object}}'>",'<th><p>{{suggest_word}}&nbsp;<span class="gray9">{{suggest_district}}</span></p></th>',"<td><p>{{suggest_count}}</p></td>","</tr>"].join(""),this.defaultText=vars.searchDefaultText.esf,this.defaultHref=vars.searchDefaultHref.esf,this.historyKey=this.getHistoryKey(this.tag)},ESFSearch.prototype.formatSearch=function(opts){var that=this;return{key:opts.key||"",hrefUrl:opts.hrefUrl||"",district:opts.district||"",tag:that.tag,suffix:that.suffix,category:opts.category||"",id:opts.id||"",comerce:opts.comerce||"",purpose:opts.purpose||""}},ESFSearch.prototype.replaceTpl=function(obj){var tpl=this.tpl;tpl=tpl.replace("{{search_key}}",obj.key),tpl=tpl.replace("{{search_object}}",JSON.stringify(obj)),tpl=tpl.replace("{{suggest_word}}",obj.key);var district=obj.district+" "+obj.comerce;return"\u793e\u533a"===obj.purpose&&(this.urlBackup(obj.key,JSON.stringify(obj)),district="\u793e\u533a"),tpl=tpl.replace("{{suggest_district}}",district),tpl=tpl.replace("{{suggest_count}}",obj.count?"\u7ea6"+obj.count+"\u6761\u623f\u6e90":"")},ESFSearch.prototype.getSuggestHtml=function(data){var that=this,json=JSON.parse(data),rows=json.hit,html="";if(rows.length)for(var i=0;i<rows.length;i++){var row=rows[i],suggestCount=row.esfcount;if("0"!==suggestCount){var obj=that.formatSearch({key:row.projname,district:row.district,category:row.category,id:row.id,comerce:row.comerce,purpose:row.purpose});3!=+row.category&&(obj.count=suggestCount),html+=that.replaceTpl(obj)}}that.suggestHtml=html},ESFSearch.prototype.searchByKey=function(pKey,data){var that=this,key=pKey,bu=that.backup[key],json=null;bu?json=JSON.parse(bu):data&&(json=data);var url=that.defaultHref,cityCode=vars.cityCode;json&&"\u793e\u533a"===json.purpose?url="http://esfbj1.test.fang.com/house/c7"+json.id+"-kw"+that.encode(key)+"/":key&&key!==that.defaultText&&(url="bt"===cityCode||"hd"===cityCode||"jining"===cityCode||"lc"===cityCode||"linyi"===cityCode||"zb"===cityCode||"hengyang"===cityCode||"wuhu"===cityCode||"ganzhou"===cityCode||"yancheng"===cityCode||"zhenjiang"===cityCode||"st"===cityCode||"leshan"===cityCode||"lyg"===cityCode||"xiangyang"===cityCode||"mas"===cityCode||"zhuzhou"===cityCode||"bengbu"===cityCode||"bh"===cityCode||"sx"===cityCode||"liuzhou"===cityCode||"yueyang"===cityCode||"huzhou"===cityCode||"zhoushan"===cityCode?url+"/esfhouse/kw"+that.encode(key)+"/":url+"/house/c61-kw"+that.encode(key)+"/"),this.openUrl(key,url);var so=that.formatSearch({key:key,hrefUrl:url});that.setHistory(key,so)},module.exports=new ESFSearch});