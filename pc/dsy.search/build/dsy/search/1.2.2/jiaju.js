define("dsy/search/1.2.2/jiaju",["dsy/search/1.2.2/interface"],function(require,exports,module){"use strict";function JiaJuSearch(){Search.call(this),this.tag="jiaju",this.suffix="\u5bb6\u5c45",this.init()}var vars=seajs.data.vars,Search=require("dsy/search/1.2.2/interface");JiaJuSearch.prototype=Object.create(Search.prototype),JiaJuSearch.prototype.constructor=JiaJuSearch,JiaJuSearch.prototype.init=function(){this.tpl=["<tr data-key=\"{{search_key}}\" data-search='{{search_object}}'>","<th><p>{{suggest_word}}</p></th>","<td>{{adImg}}</td>","</tr>"].join(""),this.defaultText=vars.searchDefaultText.jiaju,this.historyKey=this.getHistoryKey(this.tag)},JiaJuSearch.prototype.formatSearch=function(opts){var that=this;return{key:opts.key||"",adUrl:opts.adUrl||"",hrefUrl:opts.hrefUrl||"",district:opts.district||"",store:opts.store||"1",tag:that.tag,suffix:that.suffix}},JiaJuSearch.prototype.getSuggestHtml=function(data){var that=this,rows=data.split(","),suggestHtml="",advertHtml="";if(rows.length)for(var i=0;i<rows.length;i++){var row=rows[i].split("^"),tpl=that.tpl,key=row[0],url=row[1],adUrl=/^http:\/\/mshow\.fang\.com.*&u=/.test(url)?that.replaceUrlArg(url):"",obj=that.formatSearch({key:key,hrefUrl:url,adUrl:adUrl,store:adUrl?"0":"1"}),searchObject=JSON.stringify(obj);url&&that.urlBackup(key,searchObject),tpl=tpl.replace("{{search_key}}",obj.key),tpl=tpl.replace("{{search_object}}",searchObject),tpl=tpl.replace("{{suggest_word}}",obj.key),tpl=tpl.replace("{{adImg}}",adUrl?that.advertImage:""),adUrl?advertHtml+=tpl:suggestHtml+=tpl}advertHtml&&(that.advertHtml=advertHtml),that.suggestHtml=suggestHtml},JiaJuSearch.prototype.searchByKey=function(pKey,data){var that=this,key=pKey,bu=that.backup[key],json=null;bu?json=JSON.parse(bu):data&&(json=data);var url=json?json.hrefUrl:"";url=url?url.replace(/\&amp;/g,"&"):key&&key!==that.defaultText?"http://home.fang.com/album/search/?page=1&sortid=11&keyword="+that.encode(key):"http://home.fang.com/album/search/?page=1&sortid=11",this.openUrl(key,url),json||(json=that.formatSearch({key:key,hrefUrl:url})),+json.store&&that.setHistory(key,json)},module.exports=new JiaJuSearch});