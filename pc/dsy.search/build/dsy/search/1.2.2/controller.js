define("dsy/search/1.2.2/controller",["jquery","dsy/search/1.2.2/xf","dsy/search/1.2.2/esf","dsy/search/1.2.2/zf","dsy/search/1.2.2/jiaju","dsy/search/1.2.2/kuaixun","dsy/search/1.2.2/fangjia","dsy/search/1.2.2/haiwai","dsy/search/1.2.2/ditu"],function(t,e,a){"use strict";var i=t("jquery"),s=seajs.data.vars,r={dsy_D02_02:"xf",dsy_D02_03:"esf",dsy_D02_04:"zf",dsy_D02_05:"jiaju",dsy_D02_06:"kuaixun",dsy_D02_20:"haiwai",dsy_D02_19:"fangjia",dsy_D02_21:"ditu"};!function(){var t={};s.searchNavigate.each(function(e,a){var i=r[a.id];i?t[i]=a.href.replace(/\/$/,""):console.log("not find tag for id: "+a.id)}),s.searchDefaultHref=t}(),s.searchDefaultText={tejia:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\uff08\u697c\u76d8\u540d\uff09",fangjia:"\u8bf7\u8f93\u5165\u5c0f\u533a\u540d\u79f0\u6216\u5730\u5740\uff0c\u7ed9\u81ea\u5df1\u7684\u623f\u5b50\u4f30\u4e2a\u4ef7",xf:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\uff08\u697c\u76d8\u540d/\u5730\u540d/\u5f00\u53d1\u5546\u7b49\uff09",esf:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\uff08\u697c\u76d8\u540d\u6216\u5730\u540d\uff09",zf:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\uff08\u697c\u76d8\u540d\u6216\u5730\u540d\uff09",jiaju:"\u8bf7\u8f93\u5165\u6237\u578b/\u529f\u80fd\u95f4/\u98ce\u683c\u7b49\u5173\u952e\u8bcd",kuaixun:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57",haiwai:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57(\u56fd\u5bb6/\u57ce\u5e02/\u5730\u533a)",ditu:"\u8bf7\u8f93\u5165\u533a\u53bf/\u5546\u5708/\u5c0f\u533a\u540d"};var n={fangjia:t("dsy/search/1.2.2/fangjia"),xf:t("dsy/search/1.2.2/xf"),esf:t("dsy/search/1.2.2/esf"),zf:t("dsy/search/1.2.2/zf"),jiaju:t("dsy/search/1.2.2/jiaju"),kuaixun:t("dsy/search/1.2.2/kuaixun"),haiwai:t("dsy/search/1.2.2/haiwai"),ditu:t("dsy/search/1.2.2/ditu")},u=function(){this.navigateArrowSelector=".searchjt",this.navigateActiveClass="cur",this.inputCache={tag:"",key:""},this.navigateTag="",this.requestText="",this.suggestListSelector="#suggest_list",this.historyListSelector="#history_list"},c=u.prototype;c.init=function(){this.input=s.searchInput,this.adImg=s.searchInputAdvertImage,this.button=s.searchButton,this.wrapper=s.searchWrapper,this.navigate=s.searchNavigate,this.navigateArrow=i(this.navigateArrowSelector),this.defaultText=s.searchDefaultText,this.suggestList=i('<div id="suggest_list" style="display:none;"></div>').appendTo("body"),this.historyList=i('<div id="history_list" style="display:none;"></div>').appendTo("body"),this.boxHtml='<div class="search_select"><table cellspacing="0" border="0"><tbody></tbody></table></div>',this.vwgCallback(),this.bindNavigateEvent(),this.bindButtonEvent(),this.bindInputEvent(),this.bindWrapperEvent()},c.clearClass=function(){this.navigateArrow.hide(),this.navigate.removeClass(this.navigateActiveClass)},c.changeClass=function(t){this.navigateArrow.eq(t).show(),this.navigate.eq(t).addClass(this.navigateActiveClass)},c.setNavigateTag=function(){var t=this.navigate.filter("."+this.navigateActiveClass).attr("id");this.navigateTag=r[t]},c.setInputCache=function(){var t=this,e=t.inputCache,a=t.navigateTag,i=t.input.val(),s=n[a].inputIsHistory(i),r=n[a].inputIsAdvert(i),u=t.defaultText[a];!i||i===u||r||s||(e.tag===a&&e.key!==i||!e.key)&&(t.inputCache={tag:a,key:i})},c.clearInputCache=function(){this.inputCache={tag:"",key:""}},c.vwgCallback=function(t){s.userType={dsy_D02_02:"xf",dsy_D02_03:"esf",dsy_D02_04:"zf"}[t],console.log("\u7528\u6237\u8eab\u4efd\uff1a"+s.userType),this.adImg.hide();var e=t||s.vwg,a=i("#"+e).index();this.clearClass(),this.changeClass(a),this.setNavigateTag();var r=this.navigateTag;n[r].setInputValue(),this.hoverCallAdvert()},c.bindNavigateEvent=function(){var t=this;t.navigate.on("mouseover",function(){t.input.blur(),t.wrapper.empty().hide(),t.adImg.hide(),t.clearClass(),t.changeClass(i(this).index()),t.setNavigateTag();var e=t.inputCache,a=t.navigateTag;e.tag===a&&e.key?t.input.css("color","#333").val(e.key):(n[a].setInputValue(),t.hoverCallAdvert())})},c.bindButtonEvent=function(){var t=this;t.button.on("click",function(){clearInterval(t.timer);var e=t.input;t.wrapper.empty().hide(),t.input.blur(),t.clearInputCache();var a=e.val();t.navigateTag||t.setNavigateTag();var s=t.navigateTag;return a&&a===t.defaultText[s]&&(a=""),a=i.trim(a.replace(/\ +/g," ")),n[s].searchByKey(a,null,"button"),!1})},c.bindInputEvent=function(){var t=this;t.input.on("focus",function(){var e=t.navigateTag;e||(t.setNavigateTag(),e=t.navigateTag),t.adImg.hide();var a=t.inputCache,s=i(this).css("color","#333");a.tag===e&&a.key?(s.val(a.key),s.setCursorPosition()):(s.val(""),t.clearInputCache());var r=s.val();return r?t.createSuggestList(r):"xf"===e||"jiaju"===e?t.createSuggestList(""):t.createHistoryList(),r||"xf"!==e||n[e].setSessionAdvert({hasVoidSearch:1}),t.rebindInputKeyEvent(),t.watchInput(),!1}),t.input.on("blur",function(){clearInterval(t.timer),t.setInputCache()})},c.rebindInputKeyEvent=function(){var t=this,e=t.wrapper;t.input.off("keyup").on("keyup",function(a){var s=a.keyCode;if(38===s||40===s){clearInterval(t.timer),t.isSelecting=!0;var r=e.find("tr"),n=e.find("tr.selected"),u=n.index();switch(n.removeClass("selected").css("background-color","#FFFFFF"),s){case 38:n.length&&u?r.eq(u-1).addClass("selected").css("background-color","#EDEDED"):e.find("tr:last").addClass("selected").css("background-color","#EDEDED");break;case 40:n.length&&u!==r.length-1?r.eq(u+1).addClass("selected").css("background-color","#EDEDED"):e.find("tr:first").addClass("selected").css("background-color","#EDEDED")}var c=e.find("tr.selected").attr("data-key");i(this).val(c)}}),t.input.off("keydown").on("keydown",function(a){var i=t.input.val(),s=a.keyCode;if(i&&i===t.defaultText[t.navigateTag]&&t.input.val(""),t.isSelecting&&38!==s&&40!==s&&(t.watchInput(),t.isSelecting=!1),13===s){var r=e.find("tr.selected"),n=r.find("td.clear_history");n.length?n.trigger("click"):t.button.trigger("click")}})},c.bindWrapperEvent=function(){var t=this;t.wrapper.on("click","tr",function(){clearInterval(t.timer);var e=i(this).attr("data-key"),a=i(this).attr("data-search")||i(this).attr("data-history"),s=JSON.parse(a);return n[t.navigateTag].searchByKey(e,s,"list"),t.input.val(e),t.clearInputCache(),s.adUrl&&t.adImg.show(),!1}),t.wrapper.on("click",".remove_history",function(){clearInterval(t.timer);var e=i(this).parent().index(),a=t.navigateTag;return n[a].removeHistoryItem(e),t.wrapper.hide(),t.createHistoryList(),!1}),t.wrapper.on("click",".clear_history",function(){clearInterval(t.timer);var e=t.navigateTag;return n[e].clearHistory(),t.input.css("color","#888").val(t.defaultText[e]).blur(),t.wrapper.hide(),t.createSuggestList(""),!1}),t.wrapper.on("mouseover","tr",function(){i(this).css("background-color","#EDEDED")}).on("mouseout","tr",function(){i(this).css("background-color","#FFFFFF")}),t.wrapper.on("mouseover","td.clear_history, td.remove_history",function(){i(this).css("color","#c00")}).on("mouseout","td.clear_history, td.remove_history",function(){i(this).css("color","#666")})},c.watchInput=function(){var t=this;clearInterval(t.timer),t.requestText=t.input.val(),t.timer=window.setInterval(function(){var e=t.input.val();e!==t.requestText&&(e?(t.requestText=e,t.createSuggestList(e)):(t.requestText="",t.clearInputCache(),t.createHistoryList()))},1e3)},c.createHistoryList=function(){var t=this,e=t.navigateTag,a="",i=n[e],s=i.advertHtml,r=i.getHistoryHtml(3);r&&(a=("xf"===e||"jiaju"===e)&&s?r+s:i.getHistoryHtml()),a?t.wrapperShow(a,!0):t.createSuggestList("")},c.createSuggestList=function(t){var e=this.navigateTag;if("kuaixun"!==e){var a={tejia:"tejiafang",fangjia:"chafangjia",xf:"maixinfang",esf:"maiershoufang",zf:"zhaozufang",jiaju:"zhuangxiujiaju",haiwai:"haiwaifangchan",ditu:"mapfind"}[e],i={q:escape(escape(t)),vv:a,city:s.sfsf.city,atype:4,cityEn:s.cityCode};this.requestSuggest(i)}},c.requestSuggest=function(t){var e=this;e.ajax&&(e.ajax.abort(),e.ajax=0),e.requestTag=e.navigateTag,s.setRequestNumber();var a=s.sfsf.url+"&timeFlag="+s.getRequestNumber();e.ajax=i.post(a,t,function(a){if(e.ajax=0,e.requestTag!==e.navigateTag)return!1;var i=e.navigateTag,s="",r=n[i];if(a&&"error"!==a){r.getSuggestHtml(a);var u=r.suggestHtml,c=r.advertHtml,o=r.getHistoryHtml(3);"xf"===i?u?s=u:c&&(s=o+c):s="jiaju"===i?t.q?u:o?c?o+c:r.getHistoryHtml():c+u:u,s?e.wrapperShow(s,!1):e.wrapper.hide()}else t.q?e.wrapper.hide():r.getHistoryHtml(1)?e.createHistoryList():e.wrapper.hide();return!1})},c.wrapperShow=function(t,e){var a=e?this.historyList:this.suggestList,i=a.html(this.boxHtml);i.find("tbody").html(t),this.dropdown(i.html())},c.hoverCallAdvert=function(){var t=this,e=t.navigateTag;if("xf"!==e&&"jiaju"!==e)return!1;var a=n[e].getSessionAdvert();if(a&&a.hasVoidSearch)return!1;var i={q:"",init:"true",cityEn:s.cityCode};return"xf"===e?i.vv="maixinfang":"jiaju"===e&&(i.vv="zhuangxiujiaju"),t.requestAdvert(i),!0},c.requestAdvert=function(t){var e=this;e.wrapper.hide(),e.ajax&&(e.ajax.abort(),e.ajax=0),e.requestTag=e.navigateTag,s.setRequestNumber();var a=s.sfsf.url+"&timeFlag="+s.getRequestNumber();e.ajax=i.post(a,t,function(t){return e.ajax=0,!(!t||"error"===t)&&(e.requestTag===e.navigateTag&&n[e.navigateTag].setAdvert(t),!0)})},a.exports=new u});