define("dsy/search/1.2.2/ditu",["dsy/search/1.2.2/interface"],function(t,e,r){"use strict";function s(){c.call(this),this.tag="ditu",this.suffix="\u5730\u56fe",this.init()}var a=seajs.data.vars,c=t("dsy/search/1.2.2/interface");s.prototype=Object.create(c.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.tpl=["<tr data-key=\"{{search_key}}\" data-search='{{search_object}}'>",'<th><p>{{suggest_word}}<span class="gray9">-{{suggest_type}}</span></p></th>',"<td><p>{{suggest_count}}</p></td>","</tr>"].join(""),this.defaultText=a.searchDefaultText.ditu,this.defaultHref={xf:"http://newhouse."+a.cityCode+".fang.com/house/s/list/",esf:"http://esf."+a.cityCode+".fang.com/map/",zf:"http://zu."+a.cityCode+".fang.com/map/"},this.historyKey=this.getHistoryKey(this.tag)},s.prototype.formatSearch=function(t){var e=this;return{key:t.key||"",type:t.type||"",Ditu:t.Ditu?1:0,ext:t.ext||"",stateString:t.state?"\u5728\u552e":"\u5f85\u552e",hrefUrl:t.hrefUrl||"",store:"1",tag:e.tag,suffix:e.suffix}},s.prototype.replaceTpl=function(t){if(!t.Ditu&&"xf"!==t.type&&!t.count)return"";var e=this.tpl,r=this.typeString[t.type];e=e.replace("{{search_key}}",t.key),e=e.replace("{{search_object}}",JSON.stringify(t)),e=e.replace("{{suggest_word}}",t.key),t.ext&&(r=r+"-"+t.ext),e=e.replace("{{suggest_type}}",r);var s="\u5168\u90e8\u7ea6"+t.count+"\u6761";return t.Ditu?s='<span style="color:#c00">\u7279\u4ef7\u623f</span>'+t.count+"\u6761":"xf"===t.type&&(s=t.stateString),e=e.replace("{{suggest_count}}",s)},s.prototype.getSuggestHtml=function(t){for(var e=this,r=t.result,s="",a=0;a<r.length;a++){var c=r[a],i=e.formatSearch({key:c.name,type:c.type,Ditu:+c.Ditu,ext:c.ext,hrefUrl:c.href,state:c.state}),o=JSON.stringify(i);i.hrefUrl&&e.urlBackup(i.key,o),i.count=+c.count||0,s+=e.replaceTpl(i)}e.suggestHtml=s},s.prototype.searchByKey=function(t,e){var r=this,s=t,c=r.backup[s],i=null;c?i=JSON.parse(c):e&&(i=e);var o=i?i.hrefUrl:"",p=i?i.type:"xf",f=i?i.Ditu:1,u=a.DituCityCode[p][a.cityCode];if(o)o=o.replace(/\&amp;/g,"&");else if(s&&s!==r.defaultText)if(f&&u)switch(o=r.defaultHref[p],p){case"xf":o=o+"a9"+r.encode(s)+"/";break;case"esf":o=o.replace(/{{cityCode}}/,u)+"kw"+r.encode(s)+"/";break;case"zf":o=o+"a27-kw"+r.encode(s)+"/"}else a.DituCommonSearch[p].searchByKey(t,{store:0});else u?o=r.defaultHref[p]:a.DituCommonSearch[p].searchByKey(t,{store:0});o&&(a.aHref.href=o,a.aHref.click()),i||(i=r.formatSearch({key:s,hrefUrl:o,type:p})),r.setHistory(s,i)},r.exports=new s});