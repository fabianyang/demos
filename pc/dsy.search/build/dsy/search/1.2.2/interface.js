define("dsy/search/1.2.2/interface",["jquery","dsy/util/1.1.0/util","dsy/util/1.1.2/historyUtil"],function(t,e,r){"use strict";function o(){this.tag="interface",this.historyKeySuffix="His",this.hisTpl=["<tr data-key=\"{{history_key}}\" data-history='{{history_object}}'>",'<th><p>{{history_key}}&nbsp;<span class="gray9">{{history_type}}</span></p></th>','<td class="remove_history"> X </td>',"</tr>"].join(""),this.advertImage='<img src="http://imgd3.soufunimg.com/2016/07/19/25k/5c7d1e9a085b40e783e5818af3af8b20.png" style="width:28px;height:15px;float:right;">',this.typeString={xf:"\u65b0\u623f",esf:"\u4e8c\u624b\u623f",zf:"\u79df\u623f"},this.advertHtml="",this.suggestHtml="",this.backup={}}var s=t("jquery"),i=t("dsy/util/1.1.0/util"),n=t("dsy/util/1.1.2/historyUtil"),y=seajs.data.vars;o.prototype.formatSearch=function(){console.log("you do not implement the method - formatSearch! "+this.tag)},o.prototype.setAdvert=function(t){var e=this,r=t.split(","),o=y.searchInput,s=y.searchInputAdvertImage,i=r.length;if(i){var n=r[parseInt(Math.random()*(i-1))].split("^"),a=n[0],p=n[1],h=e.formatSearch({key:a,hrefUrl:p,adUrl:e.replaceUrlArg(p),store:"0"});e.urlBackup(a,JSON.stringify(h)),o.val(a),s.show()}},o.prototype.getSessionAdvert=function(){return n.getSession(this.sessionKey)},o.prototype.setSessionAdvert=function(t){n.setSession(this.sessionKey,t)},o.prototype.setInputValue=function(){var t=this,e=y.searchInput.css("color","#888"),r=t.getLastHistory();r?e.val(r.key):e.val(t.defaultText)},o.prototype.getSuggestHtml=function(){console.log("you do not implement the method - getSuggestHtml! "+this.tag)},o.prototype.getHistoryKey=function(t){return y.cityCode+t+"His"},o.prototype.getSessionKey=function(t){return y.cityCode+t+"Session"},o.prototype.searchByKey=function(){console.log("you do not implement the method - searchByKey! "+this.tag)},o.prototype.urlBackup=function(t,e){var r=this;e&&!r.backup[t]&&(r.backup[t]=e)},o.prototype.setHistory=function(t,e){var r=this;t&&t!==r.defaultText&&n.setHistory(r.historyKey,e)},o.prototype.removeHistoryItem=function(t){var e=this,r=y.searchInput,o=n.removeHistoryItem(e.historyKey,t);return o?r.val(e.defaultText):e.setInputValue(),o},o.prototype.getLastHistory=function(){return n.getLastHistory(this.historyKey)},o.prototype.inputIsHistory=function(t){return!!n.queryHistory(this.historyKey,t)},o.prototype.clearHistory=function(){n.clearHistory(this.historyKey)},o.prototype.getHistoryHtml=function(t){var e=this,r=n.getHistory(e.historyKey),o="",s=r.length;if(t&&t<s&&(s=t),r&&r.length){for(var i=0;i<s;i++){var y=r[i],a=e.hisTpl;a=a.replace(/{{history_key}}/g,y.key),a="tejia"===y.tag?a.replace(/{{history_type}}/,e.typeString[y.type]):a.replace(/{{history_type}}/,"");var p=JSON.stringify(y);a=a.replace(/{{history_object}}/,p),o+=a}t||(o+='<tr><td class="clear_history" colspan="2" style="text-align:center">\u6e05\u9664\u5386\u53f2\u8bb0\u5f55</td></tr>')}return o},o.prototype.replaceUrlArg=function(t){var e=s.trim(t);return e.match("u=http:([^&]*)")&&(e="http:"+e.match("u=http:([^&]*)")[1].trim()),e},o.prototype.encode=function(t){return i.encode(t)},o.prototype.inputIsAdvert=function(t){var e=this.backup[t];if(e){if(JSON.parse(e).adUrl)return!0}return!1},r.exports=o});