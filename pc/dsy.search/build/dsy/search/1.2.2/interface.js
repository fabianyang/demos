define("dsy/search/1.2.2/interface",["jquery","dsy/util/1.1.2/historyUtil"],function(require,exports,module){"use strict";function InterfaceSearch(){this.tag="interface",this.historyKeySuffix="His",this.hisTpl=["<tr data-key=\"{{history_key}}\" data-history='{{history_object}}'>",'<th><p>{{history_key}}&nbsp;<span class="gray9">{{history_type}}</span></p></th>','<td class="remove_history"> X </td>',"</tr>"].join(""),this.advertImage='<img src="http://imgd3.soufunimg.com/2016/07/19/25k/5c7d1e9a085b40e783e5818af3af8b20.png" style="width:28px;height:15px;float:right;">',this.typeNick={xf:"\u65b0\u623f",esf:"\u4e8c\u624b\u623f",zf:"\u79df\u623f"},this.advertHtml="",this.suggestHtml="",this.backup={}}var $=require("jquery"),HistoryUtil=require("dsy/util/1.1.2/historyUtil"),vars=seajs.data.vars;InterfaceSearch.prototype.formatSearch=function(){console.log("you do not implement the method - formatSearch! "+this.tag)},InterfaceSearch.prototype.setAdvert=function(data){var that=this,rows=data.split(","),input=vars.searchInput,adImg=vars.searchInputAdvertImage,length=rows.length;if(length){var row=rows[parseInt(Math.random()*(length-1))].split("^"),key=row[0],url=row[1],so=that.formatSearch({key:key,hrefUrl:url,adUrl:that.replaceUrlArg(url),store:"0"});that.urlBackup(key,JSON.stringify(so)),input.val(key),adImg.show()}},InterfaceSearch.prototype.getSessionAdvert=function(){return HistoryUtil.getSession(this.sessionKey)},InterfaceSearch.prototype.setSessionAdvert=function(obj){HistoryUtil.setSession(this.sessionKey,obj)},InterfaceSearch.prototype.setInputValue=function(){var that=this,input=vars.searchInput.css("color","#888"),lastHistory=that.getLastHistory();lastHistory?input.val(lastHistory.key):input.val(that.defaultText)},InterfaceSearch.prototype.getSuggestHtml=function(){console.log("you do not implement the method - getSuggestHtml! "+this.tag)},InterfaceSearch.prototype.getHistoryKey=function(tag){return vars.cityCode+tag+"His"},InterfaceSearch.prototype.getSessionKey=function(tag){return vars.cityCode+tag+"Session"},InterfaceSearch.prototype.searchByKey=function(){console.log("you do not implement the method - searchByKey! "+this.tag)},InterfaceSearch.prototype.urlBackup=function(key,string){var that=this;string&&!that.backup[key]&&(that.backup[key]=string)},InterfaceSearch.prototype.setHistory=function(key,object){var that=this;key&&key!==that.defaultText&&HistoryUtil.setHistory(that.historyKey,object)},InterfaceSearch.prototype.removeHistoryItem=function(index){var that=this,input=vars.searchInput,isClear=HistoryUtil.removeHistoryItem(that.historyKey,index);return isClear?input.css("color","#888").val(that.defaultText):that.setInputValue(),isClear},InterfaceSearch.prototype.getLastHistory=function(){return HistoryUtil.getLastHistory(this.historyKey)},InterfaceSearch.prototype.inputIsHistory=function(key){return!!HistoryUtil.queryHistory(this.historyKey,key)},InterfaceSearch.prototype.clearHistory=function(){HistoryUtil.clearHistory(this.historyKey)},InterfaceSearch.prototype.getHistoryHtml=function(count){var that=this,items=HistoryUtil.getHistory(that.historyKey),html="",length=items.length;if(count&&count<length&&(length=count),items&&items.length){for(var i=0;i<length;i++){var item=items[i],tpl=that.hisTpl;tpl=tpl.replace(/{{history_key}}/g,item.key),tpl="tejia"===item.tag?tpl.replace(/{{history_type}}/,that.typeNick[item.type]):tpl.replace(/{{history_type}}/,"");var json=JSON.stringify(item);tpl=tpl.replace(/{{history_object}}/,json),html+=tpl}count||(html+='<tr><td class="clear_history" colspan="2" style="text-align:center">\u6e05\u9664\u5386\u53f2\u8bb0\u5f55</td></tr>')}return html},InterfaceSearch.prototype.replaceUrlArg=function(pUrl){var url=$.trim(pUrl);return url.match("u=http:([^&]*)")&&(url="http:"+url.match("u=http:([^&]*)")[1].trim()),url},InterfaceSearch.prototype.encode=function(key){return vars.encode(key)},InterfaceSearch.prototype.inputIsAdvert=function(key){var bu=this.backup[key];if(bu){if(JSON.parse(bu).adUrl)return!0}return!1},InterfaceSearch.prototype.openUrl=function(key,url){vars.aHref.href=url,vars.aHref.click();var input=vars.searchInput;key||input.val(this.defaultText),input.css("color","#888")},module.exports=InterfaceSearch});