define("dsy/search/1.2.3/ditu",["jquery","dsy/search/1.2.3/interface"],function(require,exports,module){"use strict";function getHttp(url){var urlReg=/http:\/\/([^\/]+)/i,domain=url.match(urlReg);return null!==domain&&domain.length>0?domain[0]:""}function DituSearch(){Search.call(this),this.tag="ditu",this.suffix="\u5730\u56fe",this.init()}var $=require("jquery"),vars=seajs.data.vars,Search=require("dsy/search/1.2.3/interface");$.extend(DituSearch.prototype,new Search),DituSearch.prototype.init=function(){this.tpl=["<tr data-key=\"{{search_key}}\" data-search='{{search_object}}'>",'<th><p>{{suggest_word}}&nbsp;<span class="gray9">{{suggest_type}}</span>&nbsp;<span class="gray9">{{suggest_ext}}</span></p></th>',"<td></td>","</tr>"].join(""),this.defaultText=vars.searchDefaultText.ditu,this.defaultHref={xf:getHttp(vars.searchDefaultHref.xf)+"/house/s/list/",esf:getHttp(vars.searchDefaultHref.esf)+"/map/",zf:getHttp(vars.searchDefaultHref.zf)+"/map/"},this.historyKey=this.getHistoryKey(this.tag),this.one={}},DituSearch.prototype.formatSearch=function(opts){return{key:opts.key||"",hrefUrl:opts.hrefUrl||"",type:opts.type||"",ext:opts.ext||"",tag:this.tag,suffix:this.suffix}},DituSearch.prototype.replaceTpl=function(obj){var tpl=this.tpl;return tpl=tpl.replace("{{search_key}}",obj.key),tpl=tpl.replace("{{search_object}}",JSON.stringify(obj)),tpl=tpl.replace("{{suggest_word}}",obj.key),tpl=tpl.replace("{{suggest_type}}",this.typeNick[obj.type]),tpl=tpl.replace("{{suggest_ext}}",obj.ext)},DituSearch.prototype.getSuggestHtml=function(res){var rows=JSON.parse(res).data,html="";if(this.one={},rows&&rows.length)for(var i=0;i<rows.length;i++){var row=rows[i],obj=this.formatSearch({key:row.name,type:row.ywType,ext:row.ext});html+=this.replaceTpl(obj),1===rows.length&&(this.one=obj)}this.suggestHtml=html},DituSearch.prototype.searchByKey=function(pKey,pData){var key=pKey,data=pData,url=data?data.hrefUrl:"",type=vars.userType||["xf","esf"][Math.floor(2*Math.random())];if(data&&(type=data.type),!url)switch(key===this.one.key&&(data=this.one,type=this.one.type),type){case"xf":url=this.defaultHref[type]+(key?"a9"+this.encode(key)+"/":"");break;case"esf":case"zf":url=this.defaultHref[type]+(key?"kw"+encodeURIComponent(key)+"/":"")}url&&(this.openUrl(key,url),data=data||this.formatSearch({key:key,hrefUrl:url,type:type}),this.setHistory(key,data))},module.exports=new DituSearch});