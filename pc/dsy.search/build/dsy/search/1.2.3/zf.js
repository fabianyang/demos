define("dsy/search/1.2.3/zf",["jquery","dsy/search/1.2.3/interface"],function(require,exports,module){"use strict";function ZFSearch(){Search.call(this),this.tag="zf",this.suffix="\u79df\u623f",this.init()}var $=require("jquery"),vars=seajs.data.vars,Search=require("dsy/search/1.2.3/interface");$.extend(ZFSearch.prototype,new Search),ZFSearch.prototype.init=function(){this.tpl=["<tr data-key=\"{{search_key}}\" data-search='{{search_object}}'>",'<th><p>{{suggest_word}}&nbsp;<span class="gray9">{{suggest_district}}</span></p></th>',"<td><p>{{suggest_count}}</p></td>","</tr>"].join(""),this.defaultText=vars.searchDefaultText.zf,this.defaultHref=vars.searchDefaultHref.zf,this.historyKey=this.getHistoryKey(this.tag)},ZFSearch.prototype.formatSearch=function(opts){var that=this;return{key:opts.key||"",hrefUrl:opts.hrefUrl||"",district:opts.district||"",tag:that.tag,suffix:that.suffix,category:opts.category||"",id:opts.id||"",comerce:opts.comerce||"",purpose:opts.purpose||""}},ZFSearch.prototype.replaceTpl=function(obj){var tpl=this.tpl;return tpl=tpl.replace("{{search_key}}",obj.key),tpl=tpl.replace("{{search_object}}",JSON.stringify(obj)),tpl=tpl.replace("{{suggest_word}}",obj.key),tpl=tpl.replace("{{suggest_district}}",obj.district+" "+obj.comerce),tpl=tpl.replace("{{suggest_count}}","\u7ea6"+obj.count+"\u6761\u623f\u6e90")},ZFSearch.prototype.getOneRowSuggest=function(row){for(var that=this,word=["","-\u4e00\u5c45","-\u4e8c\u5c45","-\u4e09\u5c45","-\u56db\u5c45"],html="",i=0;i<5;i++){var suggestCount=row["rentcount"+(i||"")];if("0"!==suggestCount){var obj=that.formatSearch({key:row.projname+word[i],district:row.district,category:row.category,id:row.id,comerce:row.comerce,purpose:row.purpose});obj.count=suggestCount,html+=that.replaceTpl(obj)}}return html},ZFSearch.prototype.getAllRowSuggest=function(rows){for(var that=this,html="",i=0;i<rows.length;i++){var row=rows[i],suggestCount=row.esfcount;if("0"!==suggestCount){var category=row.category,obj=that.formatSearch({key:"6"===category||"7"===category?row.projname+"\u79df\u623f":row.projname,district:row.district,category:category,id:row.id,comerce:row.comerce,purpose:row.purpose});obj.count=suggestCount,html+=that.replaceTpl(obj)}}return html},ZFSearch.prototype.getSuggestHtml=function(data){var that=this,json=JSON.parse(data),rows=json.hit,html="";rows.length&&(html=1===rows.length?that.getOneRowSuggest(rows[0]):"1"===rows[0].category&&rows[0].projname===vars.searchInput.val()?that.getOneRowSuggest(rows[0]):that.getAllRowSuggest(rows)),that.suggestHtml=html},ZFSearch.prototype.searchByKey=function(key){var that=this,url=that.defaultHref,cityCode=vars.cityCode;key&&key!==that.defaultText&&(url="bt"===cityCode||"hd"===cityCode||"jining"===cityCode||"lc"===cityCode||"linyi"===cityCode||"zb"===cityCode?url+"/renthouse/s31-kw"+that.encode(key):"hengyang"===cityCode||"wuhu"===cityCode||"ganzhou"===cityCode||"yancheng"===cityCode||"zhenjiang"===cityCode||"st"===cityCode||"leshan"===cityCode||"lyg"===cityCode||"xiangyang"===cityCode||"mas"===cityCode||"zhuzhou"===cityCode||"bengbu"===cityCode||"bh"===cityCode||"sx"===cityCode||"liuzhou"===cityCode||"yueyang"===cityCode||"huzhou"===cityCode||"zhoushan"===cityCode?url+"/renthouse/kw"+that.encode(key)+"/":url+"/house/s31-kw"+that.encode(key)+"/"),this.openUrl(key,url);var so=that.formatSearch({key:key,hrefUrl:url});that.setHistory(key,so)},module.exports=new ZFSearch});