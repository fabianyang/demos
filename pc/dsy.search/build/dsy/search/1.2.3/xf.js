define("dsy/search/1.2.3/xf",["jquery","dsy/search/1.2.3/interface"],function(require,exports,module){"use strict";function XFSearch(){Search.call(this),this.tag="xf",this.suffix="\u65b0\u623f",this.init()}var $=require("jquery"),vars=seajs.data.vars,Search=require("dsy/search/1.2.3/interface");$.extend(XFSearch.prototype,new Search),XFSearch.prototype.init=function(){this.tpl=["<tr data-key=\"{{search_key}}\" data-search='{{search_object}}'>",'<th><p>{{suggest_word}}&nbsp;<span class="gray9">{{suggest_district}}</span></p></th>',"<td>{{suggest_count}}</td>","</tr>"].join(""),this.defaultText=vars.searchDefaultText.xf,this.defaultHref=vars.searchDefaultHref.xf,this.historyKey=this.getHistoryKey(this.tag),this.sessionKey=this.getSessionKey(this.tag)},XFSearch.prototype.formatSearch=function(opts){var that=this;return{key:opts.key||"",adUrl:opts.adUrl||"",hrefUrl:opts.hrefUrl||"",district:opts.district||"",estate:opts.estate||"",hrefState:opts.hrefState||"",store:opts.store||"1",tag:that.tag,suffix:that.suffix}},XFSearch.prototype.getSuggestHtml=function(data){var that=this,rows=data.split(","),suggestHtml="",advertHtml="";if(rows.length&&+rows[0]>=vars.getRequestNumber())for(var i=1;i<rows.length;i++){var row=rows[i].split("^"),tpl=that.tpl,key=row[0],url=row[3],isAdvert=/^http:\/\/mshow\.fang\.com.*&u=/.test(url);!isAdvert&&row[3]&&(key=key+" - "+row[3]);var obj=that.formatSearch({key:key,district:row[1],estate:isAdvert?"":row[3],hrefState:isAdvert?"1":row[4],hrefUrl:isAdvert?row[3]:row[5],store:isAdvert?"0":"1",adUrl:isAdvert?row[3]:""}),searchObject=JSON.stringify(obj);obj.hrefUrl&&that.urlBackup(key,searchObject);var isRedBag="\u4e70\u65b0\u623f \u9886\u7ea2\u5305 \u4eba\u4eba\u6709\u4efd"===obj.key,suggestCount=row[2],suggestWord=obj.key,suggestDistrict=obj.district;isRedBag&&(suggestWord='<font color="red">'+suggestWord+"</font>"),suggestCount=+suggestCount?isRedBag?"<p>\u652f\u6301"+suggestCount+"\u4e2a\u697c\u76d8</p>":"<p>\u7ea6"+suggestCount+"\u6761</p>":"",obj.adUrl&&(suggestCount=that.advertImage),suggestDistrict&&(suggestDistrict="["+suggestDistrict+"]"),tpl=tpl.replace("{{search_key}}",obj.key),tpl=tpl.replace("{{search_object}}",searchObject),tpl=tpl.replace("{{suggest_word}}",suggestWord),tpl=tpl.replace("{{suggest_district}}",suggestDistrict),tpl=tpl.replace("{{suggest_count}}",suggestCount),obj.adUrl?advertHtml+=tpl:suggestHtml+=tpl}advertHtml&&(that.advertHtml=advertHtml),that.suggestHtml=suggestHtml},XFSearch.prototype.searchByKey=function(pKey,data,trigger){var that=this,key=pKey,bu=that.backup[key],json=null;bu?json=JSON.parse(bu):data&&(json=data);var url=json?json.hrefUrl:"";url=url?"button"===trigger?"1"===json.hrefState?url.replace(/\&amp;/g,"&"):that.defaultHref+"/a9"+that.encode(key.split(" - ")[0])+"/":url.replace(/\&amp;/g,"&"):key&&key!==that.defaultText?that.defaultHref+"/a9"+that.encode(key)+"/":that.defaultHref+"/",this.openUrl(key,url),json||(json=that.formatSearch({key:key,hrefUrl:url})),+json.store&&that.setHistory(key,json)},module.exports=new XFSearch});